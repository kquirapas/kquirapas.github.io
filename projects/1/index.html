<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link href="/favicon.ico" rel="icon"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="#000000" name="theme-color"><meta content="Web site created using create-react-app" name="description"><link href="/logo192.png" rel="apple-touch-icon"><link href="/manifest.json" rel="manifest"><title>Kristian Quirapas</title><script defer src="/static/js/main.9450104e.js"></script><style data-styled="active" data-styled-version="5.3.3">.gHSIHk{visibility:hidden}.fSaYiK{color:#5aab93}.jyIXsn{color:#fff}.irVrJD{z-index:999;display:none;background-color:#0c1c2c;border-bottom:1px solid #5aab93;color:#fff;box-sizing:border-box;padding:2vh 5vw;width:100vw;position:fixed;top:0;-webkit-box-pack:justify;justify-content:space-between;-webkit-box-align:center;align-items:center}.irVrJD div{display:flex;-webkit-box-align:center;align-items:center}.irVrJD #mobile-nav-logo{box-sizing:border-box;display:flex;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;user-select:none}.irVrJD #mobile-nav-logo span{font-size:30px}.irVrJD #mobile-nav-logo:hover{cursor:pointer}.irVrJD #mobile-nav-logo:hover span{color:#fff}@media (max-width:768px){.irVrJD{display:flex}}.ioBWwh{padding-left:2vw;color:#fff;font-size:20px;text-decoration:none}.lmA-DJk{background-color:rgba(12,28,44,.8);display:none}.lmA-DJk #logo{font-size:50px}@media (min-width:768px){.lmA-DJk{z-index:999;width:100vw;position:fixed;top:0;display:flex;flex-direction:row;-webkit-box-pack:justify;justify-content:space-between;padding:2vh 1vw;box-sizing:border-box;transition:border .5s ease-in-out 0s,background-color .5s 0s}}.hWsxYB{display:flex;flex-direction:column;-webkit-box-pack:center;justify-content:center;-webkit-box-align:start;align-items:start;margin:0 20px}.fPzTOL{color:#fff}.bfpJgJ{display:flex;flex-direction:row;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center}.cnhpCP{text-decoration:none}.hVfCxq{display:flex;flex-direction:row;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center}.hVfCxq:visited{color:#fff}.kDJYrX{display:flex;-webkit-box-align:center;align-items:center;margin:0 20px;color:silver}.kDJYrX:hover .sc-bdvvtL{visibility:visible;color:#5aab93}.kDJYrX span{margin-right:2px}.ecXNEW{padding:0 3vw}@media (max-width:768px){.ecXNEW{padding:0 10vw}}.bBEVnu{display:grid;grid-template-columns:.5fr 3fr;gap:3vw 3vw;border-top:1px solid #5aab93;padding:10vh 0}@media (max-width:1366px){.bBEVnu{row-gap:5vh;grid-template-columns:1fr}}.yEhha{display:flex;flex-direction:column;-webkit-box-pack:start;justify-content:start;-webkit-box-align:center;align-items:center}.fwfrIA{display:flex;flex-direction:column;-webkit-box-pack:justify;justify-content:space-between}.gcEiaU{display:grid;grid-template-columns:1fr 1fr 1fr 1fr}@media (max-width:768px){.gcEiaU{row-gap:4vh;grid-template-columns:1fr 1fr}}@media (max-width:411px){.gcEiaU{grid-template-columns:1fr}}.dVUmbB{margin-bottom:5vh;display:block;text-decoration:none;color:#5aab93}@media (max-width:768px){.dVUmbB{margin-bottom:2vh}}@media (max-width:411px){.dVUmbB{margin-bottom:3vh}}.fYZwZK{display:flex;flex-direction:column;color:#fff}.fYZwZK a{margin-bottom:5vh}@media (max-width:768px){.fYZwZK a{margin-bottom:4vh}}@media (max-width:411px){.fYZwZK{grid-template-columns:1fr;margin-bottom:0}.fYZwZK a{margin-bottom:3vh}}.eUMbzb{margin:0;transition:transform .1s ease 0s}.bCfVhK{text-decoration:none;color:#fff}.bCfVhK:hover .sc-bBHxTw{transform:translateY(-5px);color:#5aab93}.iLrcSu{text-decoration:none;color:#fff}.iLrcSu:hover .sc-bBHxTw{transform:translateY(-5px);color:#5aab93}.jinLTf{min-width:400px;width:100%;border-radius:10px;background-color:#5aab93}@media (max-width:768px){.jinLTf{min-width:200px;height:auto}}.gyiHNA{margin-top:20px;font-family:"Lato Black";font-size:22px;color:#5aab93;align-self:start}.jjLAVq{margin:0;font-family:"Lato Regular";color:#fff;letter-spacing:3px;align-self:start}.gIHelE{padding:0 0 3vh;font-family:"Lato Regular";color:#5aab93;letter-spacing:3px;align-self:start}@media (max-width:768px){.gIHelE{text-align:center}}.ezpSRo img{overflow:hidden;width:auto;max-width:100%}.ezpSRo h1,.ezpSRo h2,.ezpSRo h3,.ezpSRo h4,.ezpSRo h5{color:#5aab93;font-family:"Lato Black";font-size:34px}@media (max-width:768px){.ezpSRo h1,.ezpSRo h2,.ezpSRo h3,.ezpSRo h4,.ezpSRo h5{font-size:20px}}.ezpSRo h6{margin:5vh;text-align:center;color:silver;font-family:"Lato Regular";font-size:16px;letter-spacing:3px}.ezpSRo p{margin:2vh 0 5vh;line-height:140%;font-family:"Lato Regular";font-size:20px}.ezpSRo blockquote{margin:0 2vw;padding:0 1vw;border-left:5px solid #fff;color:#fff}.ezpSRo blockquote p{padding:1vh 0;margin:0}.ezpSRo ol,.ezpSRo ul{font-family:"Lato Regular";font-size:20px;margin:2vh 0 5vh}.ezpSRo ol li,.ezpSRo ul li{margin:1vh 0}.ezpSRo strong{color:#fff;font-family:"Lato Black"}.ezpSRo em,.ezpSRo i{color:#fff;font-family:"Lato Regular"}.ezpSRo a{text-decoration:none;color:#fff;font-family:"Lato Regular"}.ezpSRo a:hover{text-decoration:underline}.ezpSRo code{max-height:100vh;overflow:auto;box-sizing:border-box;border-width:1px 1px 1px 2vw;border-style:solid;border-color:#5aab93;border-image:initial;display:block;padding:3vh 1vw;margin:2vh 0 5vh;font-family:"RobotoMono Regular";font-size:20px;background-color:#0c1c2c;color:#5aab93}@media (max-width:768px){.ezpSRo code{font-size:16px}}.kzfRhn{display:flex;flex-direction:column;-webkit-box-pack:start;justify-content:start;-webkit-box-align:center;align-items:center}.ejsVHQ{width:50vw}@media (max-width:768px){.ejsVHQ{width:80vw}}.gNnETW{padding:20vh 0 0;margin-bottom:10vh;width:100%;color:silver}.gNnETW h1{margin:0;padding:5vh 0;color:#fff}@media (max-width:768px){.gNnETW h1{font-size:50px}}@media (max-width:411px){.gNnETW h1{font-size:34px}}.gNnETW h2{margin:0;color:#5aab93}@media (max-width:768px){.gNnETW h2{font-size:24px}}@media (max-width:411px){.gNnETW h2{font-size:20px}}.gNnETW span{color:#fff}.jYOKWy{text-decoration:none;color:#fff;margin-right:20px}.jYOKWy:hover{cursor:pointer;color:#5aab93}.fQhynS{color:#5aab93!important}@font-face{font-family:"RobotoMono Regular";src:url(/static/media/RobotoMono-Regular.418a8f9f65ccad0918af.ttf) format("truetype")}@font-face{font-family:"RobotoSlab Black";src:url(/static/media/RobotoSlab-Black.43ddeddbec9021b940de.ttf) format("truetype")}@font-face{font-family:"Lato Black";src:url(/static/media/Lato-Black.57dee8aface5572f9101.ttf) format("truetype")}@font-face{font-family:"Lato Regular";src:url(/static/media/Lato-Regular.9d883d540ee2b4de8024.ttf) format("truetype")}@font-face{font-family:"Lato Bold";src:url(/static/media/Lato-Bold.636be8de934918e38ed9.ttf) format("truetype")}.font-robotoslab{font-family:"RobotoSlab Black"}.font-green{color:#5aab93}.font-blue{color:#0c1c2c}.font-brown{color:silver}.font-white{color:#fff}.homepage-header{font-family:"Lato Black";font-size:50px}.page-header{font-family:"Lato Black";font-size:100px}.section-header{font-family:"Lato Black";font-size:34px}.body-text{line-height:140%;font-family:"Lato Regular";font-size:20px}.secondary-text{font-family:"Lato Regular";font-size:16px;letter-spacing:3px}.nav-main-link{font-family:"Lato Bold";font-size:22px}.nav-sub-link{font-family:"Lato Regular";font-size:22px}.footer-header{font-family:"Lato Bold";font-size:22px}.footer-link{font-family:"Lato Regular";font-size:22px}.nav-logo{font-family:"Lato Bold";font-size:26px}</style><link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" rel="stylesheet" data-react-helmet="true"><link href="/apple-icon-57x57.png" rel="apple-touch-icon" data-react-helmet="true" sizes="57x57"><link href="/apple-icon-60x60.png" rel="apple-touch-icon" data-react-helmet="true" sizes="60x60"><link href="/apple-icon-72x72.png" rel="apple-touch-icon" data-react-helmet="true" sizes="72x72"><link href="/apple-icon-76x76.png" rel="apple-touch-icon" data-react-helmet="true" sizes="76x76"><link href="/apple-icon-114x114.png" rel="apple-touch-icon" data-react-helmet="true" sizes="114x114"><link href="/apple-icon-120x120.png" rel="apple-touch-icon" data-react-helmet="true" sizes="120x120"><link href="/apple-icon-144x144.png" rel="apple-touch-icon" data-react-helmet="true" sizes="144x144"><link href="/apple-icon-152x152.png" rel="apple-touch-icon" data-react-helmet="true" sizes="152x152"><link href="/apple-icon-180x180.png" rel="apple-touch-icon" data-react-helmet="true" sizes="180x180"><link href="/android-icon-192x192.png" rel="icon" data-react-helmet="true" sizes="192x192" type="image/png"><link href="/favicon-32x32.png" rel="icon" data-react-helmet="true" sizes="32x32" type="image/png"><link href="/favicon-96x96.png" rel="icon" data-react-helmet="true" sizes="96x96" type="image/png"><link href="/favicon-16x16.png" rel="icon" data-react-helmet="true" sizes="16x16" type="image/png"><link href="/manifest.json" rel="manifest" data-react-helmet="true"><meta content="Kristian Quirapas | Portfolio" data-react-helmet="true" property="og:title"><meta content="https://kquirapas.github.io" data-react-helmet="true" property="og:url"><meta content="A blockchain engineer's passion for building and security." data-react-helmet="true" property="og:description"><meta content="/assets/meta-image.jpg" data-react-helmet="true" property="og:image"><meta content="website" data-react-helmet="true" property="og:type"><meta content="summary_large_image" data-react-helmet="true" name="twitter:card"><meta content="Kristian Quirapas | Portfolio" data-react-helmet="true" name="twitter:title"><meta content="https://kquirapas.github.io" data-react-helmet="true" name="twitter:url"><meta content="A blockchain engineer's passion for building and security." data-react-helmet="true" name="twitter:description"><meta content="/assets/meta-image.jpg" data-react-helmet="true" name="twitter:image:src"><meta content="#ffffff" data-react-helmet="true" name="msapplication-TileColor"><meta content="/ms-icon-144x144.png" data-react-helmet="true" name="msapplication-TileImage"><meta content="#ffffff" data-react-helmet="true" name="theme-color"><link href="https://fonts.googleapis.com" rel="preconnect"><link href="https://fonts.gstatic.com" rel="preconnect"></head><body style="margin:0;background-color:#0c1c2c;color:silver"><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><nav class="sc-eCImPb irVrJD"><div><span class="material-symbols-rounded font-green" id="logo">network_intelligence</span><a href="/" class="sc-jRQBWg ioBWwh body-text font-white">Kristian Quirapas</a></div><div class="nav-main-link font-white" id="mobile-nav-logo"><span class="material-symbols-rounded font-green" id="logo">menu</span></div></nav><nav class="sc-gKclnd lmA-DJk nav"><a href="/" class="sc-jrQzAO sc-kDTinF cnhpCP hVfCxq"><span class="material-symbols-rounded font-green" id="logo">network_intelligence</span><span class="sc-iCfMLu hWsxYB"><div class="sc-furwcr fPzTOL nav-logo">Kristian Quirapas</div><span class="sc-egiyK ddmSdI secondary-text font-green">Blockchain Developer</span></span></a><div class="sc-pVTFL bfpJgJ"><a href="/projects" class="sc-jrQzAO sc-crHmcD cnhpCP kDJYrX nav-main-link"><span class="material-symbols-rounded font-green">work</span><span class="sc-gsDKAQ fSaYiK">> </span><span class="sc-dkPtRN jyIXsn">Projects</span><span class="sc-gsDKAQ fSaYiK"> &lt;</span></a><a href="/experiments" class="sc-jrQzAO sc-crHmcD cnhpCP kDJYrX nav-main-link"><span class="material-symbols-rounded font-green">science</span><span class="sc-bdvvtL gHSIHk">> </span>Experiments<span class="sc-bdvvtL gHSIHk"> &lt;</span></a><a href="/contacts" class="sc-jrQzAO sc-crHmcD cnhpCP kDJYrX nav-main-link"><span class="material-symbols-rounded font-green">waving_hand</span><span class="sc-bdvvtL gHSIHk">> </span>Contacts<span class="sc-bdvvtL gHSIHk"> &lt;</span></a><a href="/about" class="sc-jrQzAO sc-crHmcD cnhpCP kDJYrX nav-main-link"><span class="material-symbols-rounded font-green">person</span><span class="sc-bdvvtL gHSIHk">> </span>About<span class="sc-bdvvtL gHSIHk"> &lt;</span></a></div></nav><div class="sc-fbyfCU kzfRhn"><div class="sc-GEbAx ejsVHQ"><header class="sc-gsNilK gNnETW"><a href="/projects" class="sc-bXTejn jYOKWy nav-main-link"><span class="sc-eGRUor fQhynS">&lt; </span>Go to Projects</a><h1 class="page-header">Blockplace</h1><h2 class="section-header">Fullstack Blockchain Developer</h2><span class="body-text">February 1, 2022 | Polygon</span></header><main class="sc-fvxzrP ezpSRo"><h1>Goals for this Project</h1><ul><li>Deploy on Polygon</li><li>Develop Contracts with Test-Driven Development (TDD)</li><li>Connect contract Backend to Frontend</li><li>Allow user to mint and change color of a Pixel NFT</li></ul><h1>What is r/Place?</h1><p>r/Place is the inspiration behind this dapp. If you want to know more check it out in this link: <a href="https://www.reddit.com/r/place/">r/Place Introduction</a></p><h1>Overview</h1><p><strong>Blockplace is a canvas of 1000x1000 Pixel NFTs (1M NFTs)</strong>. The sheer amount of NFTs (pixels) to render into the page is already one of the problems I had to overcome in this build. If you’re interested in knowing more continue reading.</p><p><img src="/assets/projects/blockplace/closeup.png" alt="Close up of Blockplace"></p><h6>A close up screenshot of Blockplace showing what it looks like</h6><h1>Where is it?</h1><p>The contracts are deployed in <strong>Polygon's Mumbai Testnet</strong>. It's an MVP hence deploying it to mainnet is not a good idea.</p><h1>Problem #1: Rendering Pixel Colors into the Page</h1><p>I initially tried rendering each pixel in a canvas element one by one with nested for loops. It can be done but it's barely usable for how it freezes the app. It was difficult because I had to go through a lot of documentations and libraries to see what would make it work. I tried *<em>Three.js, Pixel.js, WebGL, P5.js, etc</em>. WebGL and Pixel.js would have done it but I've stumbled upon an interesting topic: <strong>ImageData</strong>.</p><h1>ImageData()</h1><p>Essentially drawing pixels one by one is tedious and slow. It will take a lifetime before one can mint a Pixel NFT. The solution to this is to leverage ImageData().</p><p><em>ImageData is an interface that represents the underlying pixel data of a &lt;canvas> element</em>. It allows you to jump down in the pixels and manipulate it as much as you like. What this allowed me to do is to display an array of 1000x1000 pixels into the canvas <strong>way faster than for loops</strong>.</p><p>Let me demonstrate the monstrosity of this canvas with a randomized render of pixels.</p><p><img src="/assets/projects/blockplace/monster.png" alt="Monsterous Canvas of Pixels"></p><p>As you can see <strong>that's a lot</strong>. Imagine rendering that into a web page with for loops. You're not getting anything done soon with a canvas of that scale. But with <strong>ImageData</strong>, the performance is <strong>100x better</strong>.</p><h1>Problem #2: Blacklist + Whitelist = Greylist?</h1><p>In the Web 3 space the term <strong>whitelisted</strong> means someone has the privilege to mint an NFT earlier than the others at <em>presale prices</em>. This is the list NFT hustlers are fighting to be part of. <strong>Blacklist</strong>, on the other hand, is just a list of addresses that ban a user from transacting with the smart contract.</p><p>So what's a <strong>greylist</strong>?</p><p>A greylist is the combination of <em>both a whitelist and a blacklist</em>. It allows a user to transact with the smart contract, but at the same time preventing them from spamming transactions. Greylist at its core is an anti-spam smart contract that controls the minting rate of users.</p><p><strong>How can this be done?</strong> By using <strong>block.timestamp</strong>.</p><p>I won't go deep into the details, but you can check the greylist smart contract code down below.</p><pre><code>  //SPDX-License-Identifier: MIT
  pragma solidity ^0.8.4;

  contract Greylist {
    // address of minter -> timestamp of greylist end
    mapping(address => uint256) public greylistedAddresses;

    function addToGreylist() public {
      // greylist address for 2 seconds
      greylistedAddresses[msg.sender] = block.timestamp + 20 seconds;
    }

    function isGreylisted() public view returns (bool) {
      if (greylistedAddresses[msg.sender] > block.timestamp) {
        return true;
      }
      return false;
    }

    function getGreylistDuration() public view returns (uint256) {
      if (greylistedAddresses[msg.sender] &lt; block.timestamp) {
        return 0;
      }

      return greylistedAddresses[msg.sender] - block.timestamp;
    }
  }
</code></pre><p><em>The Greylist.sol smart contract is used for mirroring the temporary ban that r/Place does for its users.</em></p><h1>Problem #2: Smart Contract for Minting</h1><p>The next problem to address is coding the smart contract to allow people to mint Pixel NFTs with Blockplace. If you're curious how I did that here's a snippet.</p><p><strong>Heads up! It's quite a long piece of code. Here's a summary of what to take notice of:</strong></p><ul><li>It's an extension of OpenZeppelin's ERC721 standard.</li><li>Greylist contract is inherited from as seen on <strong>line 6</strong>.</li></ul><pre><code>  //SPDX-License-Identifier: MIT
  pragma solidity ^0.8.4;

  import '@openzeppelin/contracts/token/ERC721/extensions/ERC721Enumerable.sol';
  import '@openzeppelin/contracts/access/Ownable.sol';
  import './Greylist.sol';

  contract Place is ERC721Enumerable, Ownable, Greylist {
    struct Color {
      uint8 r;
      uint8 g;
      uint8 b;
    }

    string baseTokenURI;

    uint256 public price = 0.001 ether;
    bool public paused;

    uint256 public tokenIdsLeft;

    // keep track of minting
    // tokenId => true/false
    mapping(uint256 => bool) public minted;

    // keep track of token by associating a tokenId with a color string
    // tokenId => Color(r,g,b)
    mapping(uint256 => Color) public color;


    modifier onlyWhenNotPaused {
      require(!paused, 'Place contract currently paused');
      _;
    }

    constructor(string memory _baseTokenURI, uint256 _maxTokenIds) ERC721("Blockplace Pixel", "BP") {
      baseTokenURI = _baseTokenURI;
      tokenIdsLeft = _maxTokenIds;
    }

    function _baseURI() internal view virtual override returns (string memory) {
      return baseTokenURI;
    }

    function mintPixel(uint256 tokenId) public payable onlyWhenNotPaused {
      // msg.sender not greylisted
      require(!isGreylisted(), 'Denied: You are greylisted');
      // have enough tokens left
      require(tokenIdsLeft > 0, 'All tokens minted');
      // token should not be owned
      require(!minted[tokenId], 'Token already minted');
      // must have enough msg.value (payment)
      require(msg.value >= price, 'Insufficient deposit');

      tokenIdsLeft -= 1;
      minted[tokenId] = true;
      color[tokenId] = Color({r: 0, g: 0, b: 0});
      addToGreylist();
      _safeMint(msg.sender, tokenId);
    }

    // set color
    function setColor(uint256 tokenId, Color memory _colorHex) public {
      // tokenId must exists (minted)
      require(minted[tokenId], 'Denied: Token not yet minted');
      // must be Owner of token
      require(ownerOf(tokenId) == msg.sender, 'Denied: you are not the token owner');
      color[tokenId] = Color({r: _colorHex.r, g: _colorHex.g, b: _colorHex.b});
    }

    function setPaused(bool _paused) public onlyOwner {
      paused = _paused;
    }

    // withdraw
    function withdraw() public onlyOwner {
      address _owner = owner();
      uint256 amount = address(this).balance;
      (bool sent, ) = _owner.call{value: amount}("");
      require(sent, 'Failed to send balance');
    }

    // needed functions
    receive() external payable {}
    fallback() external payable {}
  }
</code></pre><h1>Problem #3: Test-Driven Development for Smart Contracts (TDD with Waffle)</h1><p>I constructed both Greylist contracts and Place contracts with test-driven development. Here's my test files.</p><p><strong>Greylist.test.js</strong></p><pre><code>  const { expect } = require("chai");
  const { ethers } = require("hardhat");

  const delay = ms => new Promise(res => setTimeout(res, ms))

  describe('Greylist Contract', () => {
    let greylist;
    let owner, acc1, acc2;


    beforeEach(async () => {
      // getSigners() get the signer from hardhat's local node
      [owner, acc1, acc2] = await ethers.getSigners();
      const GreylistContract = await ethers.getContractFactory('Greylist', owner);
      greylist = await GreylistContract.deploy();

      // wait deployment to be mined
      await greylist.deployed();
    });

    it('should not be greylisted at start', async ()  => {
      expect(await greylist.isGreylisted()).to.equal(false);
    })

    it('should be greylisted after adding to greylist', async ()  => {
      await greylist.addToGreylist();
      expect(await greylist.isGreylisted()).to.equal(true);
    })
  });
</code></pre><p><strong>Place.test.js</strong></p><pre><code>  const { expect } = require("chai");
  const { ethers } = require("hardhat");

  const delay = ms => new Promise(res => setTimeout(res, ms))

  describe('Place Contract', () => {
    let place;
    let owner, acc1, acc2;

    beforeEach(async () => {
      // getSigners() get the signer from hardhat's local node
      [owner, acc1, acc2] = await ethers.getSigners();
      const PlaceContract = await ethers.getContractFactory('Place', owner);
      place = await PlaceContract.deploy('test.com/api/', 1000000);

      // wait deployment to be mined
      await place.deployed();
    });


    describe('Deployment', () => {
      it('should have tokenIdsLeft of 1,000,000', async () => {
        expect((await place.tokenIdsLeft()).toString()).to.equal('1000000');
      });

      it('should have a price of 1eth', async () => {
        expect(ethers.utils.formatEther(await place.price())).to.equal('1.0');
      });
    });


    describe('Pausing', () => {
      it('should not be paused start', async ()  => {
        expect(await place.paused()).to.equal(false);
      });

      it('should be paused', async ()  => {
        expect(await place.paused()).to.equal(false);
        await place.setPaused(true);
        expect(await place.paused()).to.equal(true);
      });

      it('should not be allowed to mint when paused', async () => {
        await expect(place.mintPixel(0, {value: ethers.utils.parseEther('1')})).to.not.be.reverted;
        await place.setPaused(true);
        await expect(place.mintPixel(0)).to.be.revertedWith('Place contract currently paused');
      });
    });


    describe('Minting', () => {
      let place, place2;
      let owner, acc1, acc2;

      beforeEach(async () => {
        // getSigners() get the signer from hardhat's local node
        [owner, acc1, acc2] = await ethers.getSigners();

        const PlaceContract = await ethers.getContractFactory('Place', owner);
        place = await PlaceContract.deploy('test.com/api/', 1);
        // wait deployment to be mined
        await place.deployed();

        const PlaceContract2 = await ethers.getContractFactory('Place', owner);
        place2 = await PlaceContract2.deploy('test.com/api/', 2);
        // wait deployment to be mined
        await place2.deployed();
      });

      it('should mint and decrement tokendIdsLeft', async () => {
        await expect(place.mintPixel(0, {value: ethers.utils.parseEther("1.0")})).to.not.be.reverted;
        expect(await place.tokenIdsLeft()).to.equal(0);
      });

      it('should mint and store tokenId in color', async () => {
        await expect(place.mintPixel(0, {value: ethers.utils.parseEther("1.0")})).to.not.be.reverted;
        expect((await place.color(0))['r']).to.equal(255);
        expect((await place.color(0))['g']).to.equal(255);
        expect((await place.color(0))['r']).to.equal(255);
      });

      it('should NOT be able to mint insufficient deposit', async () => {
        await expect(place.mintPixel(0, {value: ethers.utils.parseEther("0.5")})).to.be.revertedWith('Insufficient deposit');
      });


      it('should NOT be able to mint because no more tokens left', async () => {
        await expect(place.mintPixel(0, {value: ethers.utils.parseEther("1.0")})).to.not.be.reverted;

        // changing the signer for same contract
        // Signer: Owner -> Acc2
        const contract = await ethers.getContractAt('Place', place.address, acc2);
        await expect(contract.mintPixel(0, {value: ethers.utils.parseEther("1")})).to.be.revertedWith('All tokens minted');
      });

      it('should NOT mint because tokenId owned', async () => {
        const tx = await expect(place2.mintPixel(0, {value: ethers.utils.parseEther("1.0")})).to.not.be.reverted;
        await tx.wait();

        // delay to dodge greylist
        await delay(3000);

        await expect(place2.mintPixel(0, {value: ethers.utils.parseEther("1.0")})).to.be.revertedWith('Token already minted');
      });
    });


    describe('Greylisting', () => {
      it('should NOT mint because greylisted', async () => {
        await expect(place.mintPixel(0, {value: ethers.utils.parseEther("1.0")})).to.not.be.reverted;
        await expect(place.mintPixel(0, {value: ethers.utils.parseEther("1.0")})).to.be.revertedWith('Denied: You are greylisted');
      });
    
      it('should mint because greylist lifted', async () => {
        await expect(place.mintPixel(0, {value: ethers.utils.parseEther("1.0")})).to.not.be.reverted;
        await delay(3000);
        await expect(place.mintPixel(1, {value: ethers.utils.parseEther("1.0")})).to.not.be.reverted;
      });
    });

    describe('Changing Color', () => {
      let local_place;

      beforeEach(async () => {
        local_place = await ethers.getContractAt('Place', place.address, acc1);
        await place.mintPixel(0, {value: ethers.utils.parseEther("1.0")});
      });

      it('should NOT set because not token owner', async () => {
        await expect(local_place.setColor(0, {r: 255, g: 255, b: 255})).to.be.revertedWith('Denied: you are not the token owner');
      })

      it('should NOT set because tokenId does not exists', async () => {
        await expect(local_place.setColor(1, {r: 255, g: 255, b: 255})).to.be.reverted;
      })


      it('it should set because token owner', async () => {
        await expect(place.setColor(0, {r: 255, g: 255, b: 255})).to.not.be.reverted;
      })

      it('should NOT set because color is wrong (overflow)', async () => {
        await expect(local_place.setColor(0, {r: 265, g: 285, b: 200})).to.be.reverted;
      });

      it('should NOT set because color is wrong (negative)', async () => {
        await expect(local_place.setColor(0, {r: -100, g: 285, b: 200})).to.be.reverted;
      });

      it('should NOT set because color is wrong (not a num)', async () => {
        await expect(local_place.setColor(0, {r: '100', g: 285, b: 200})).to.be.reverted;
      });

      it('HOTDOG', async () => {
        try {
          await local_place.setColor(0, {r: '100', g: 285, b: 200});
        } catch (err) {
          console.log(err);
        }
      });

    });
  });
</code></pre><p><img src="/assets/projects/blockplace/home.png" alt="Blockplace Home"></p><h1>What I learned from this build?</h1><ul><li>Test-Driven Development should be used sparingly. Use it when you plan on building a project all the way through. If it's an experiment, no need to do TDD.</li><li>ImageData is useful when rendering pixels into the canvas element.</li><li>ERC721 standard and methods</li><li>ERC721Enumerable methods</li><li>How NFT collection drops are done</li></ul></main></div></div><footer class="sc-fFeiMQ ecXNEW"><div class="sc-bkkeKt bBEVnu"><aside class="sc-ieecCq yEhha"><img src="/assets/branding.jpg" class="sc-iJKOTD jinLTf"><span class="sc-giYglK gyiHNA">Kristian Quirapas</span><p class="sc-ezbkAF jjLAVq">Blockchain Developer</p></aside><aside class="sc-dJjYzT fwfrIA"><div class="sc-hGPBjI gcEiaU"><aside class="sc-dlVxhl eqDgMT"><a href="/contacts" class="sc-kfPuZi dVUmbB footer-header">Contacts</a><div class="sc-fKVqWL fYZwZK"><a href="https://mail.google.com/mail/u/0/?fs=1&to=kmquirapas@gmail.com&tf=cm" class="sc-iwjdpV bCfVhK footer-link" target="_blank"><p class="sc-bBHxTw eUMbzb">kmquirapas@gmail.com</p></a><a href="https://linkedin.com/in/kristian-quirapas-348603213" class="sc-iwjdpV bCfVhK footer-link"><p class="sc-bBHxTw eUMbzb">LinkedIn Profile</p></a><a href="https://github.com/kquirapas" class="sc-iwjdpV bCfVhK footer-link"><p class="sc-bBHxTw eUMbzb">Github</p></a><a href="https://www.youtube.com/channel/UCaU88FuhkVKO0PJViRjvTLw" class="sc-iwjdpV bCfVhK footer-link"><p class="sc-bBHxTw eUMbzb">Youtube Channel</p></a><a href="https://twitter.com/k_quirapas" class="sc-iwjdpV bCfVhK footer-link"><p class="sc-bBHxTw eUMbzb">Twitter</p></a></div></aside><aside class="sc-dlVxhl eqDgMT"><a href="/projects" class="sc-kfPuZi dVUmbB footer-header">Projects</a><div class="sc-fKVqWL fYZwZK"><a href="/projects/0" class="sc-cxpSdN iLrcSu footer-link"><p class="sc-bBHxTw eUMbzb">Personal Portfolio</p></a><a href="/projects/1" class="sc-cxpSdN iLrcSu footer-link"><p class="sc-bBHxTw eUMbzb">Blockplace</p></a><a href="/projects/2" class="sc-cxpSdN iLrcSu footer-link"><p class="sc-bBHxTw eUMbzb">Proximic</p></a></div></aside><aside class="sc-dlVxhl eqDgMT"><a href="/experiments" class="sc-kfPuZi dVUmbB footer-header">Experiments</a><div class="sc-fKVqWL fYZwZK"><a href="/projects/0" class="sc-cxpSdN iLrcSu footer-link"><p class="sc-bBHxTw eUMbzb">Image Generation</p></a><a href="/projects/1" class="sc-cxpSdN iLrcSu footer-link"><p class="sc-bBHxTw eUMbzb">Rust: TimeZone Tool</p></a></div></aside><aside class="sc-dlVxhl eqDgMT"><a href="/about" class="sc-kfPuZi dVUmbB footer-header">About</a><div class="sc-fKVqWL fYZwZK"><a href="/about" class="sc-cxpSdN iLrcSu footer-link"><p class="sc-bBHxTw eUMbzb">Get my Resume</p></a></div></aside></div></aside></div><p class="sc-bYoBSM gIHelE">© Kristian Quirapas. All Rights Reserved</p></footer></div></body></html>